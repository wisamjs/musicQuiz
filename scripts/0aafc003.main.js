var trivia=function(){var a=["{artist} produced the album:","Which artist created the album {album}?"],b={question:"produced the album:"},c=[];return{getCurrentQuestion:function(){return b.question},getPlaceholder:function(){var a=this.getCurrentQuestion();return a.substring(a.indexOf("{"),a.indexOf("}")+1)},getCurrentAnswer:function(){return b.answer},setCurrentAnswer:function(a){b.answer=a},setCurrentQuestion:function(a){b.question=a+" produced the album:"},reset:function(){b.question=a[0]},addTriviaMap:function(a){c=a},getTriviaMap:function(){return c},shuffleTriviaMap:function(){c=_.shuffle(c)},verifyChoice:function(a){void 0===trivia.getCurrentAnswer()&&console.log("ERROR UNDEFINED");var b=trivia.getCurrentAnswer()===a;return b}}}(),test;$(document).ready(function(){var a=function(){var b="697800e6a9fe10f5c42eab30c9ef6cb4",c="json",d=[],e=0,f=3;return{getResponse:function(a,d,e){a.api_key=b,a.format=c,$.ajax({url:"http://ws.audioscrobbler.com/2.0/",type:"GET",data:a,dataType:"jsonp",success:function(a){e(a,d)}})},getSimilarArtists:function(){for(var b=0;b<d.length;b++)b===d.length-1?this.getResponse({artist:d[b],method:"artist.getsimilar"},b,function(b){for(var c=b.similarartists.artist.length,e=_.random(1,c-1),f=b.similarartists.artist[e].name;-1===d.indexOf(f);)-1!==d.indexOf(f)&&(e=e=_.random(1,c-1),f=b.similarartists.artist[e].name),a.addArtist(f);a.generate(function(){a.display()})}):this.getResponse({artist:d[b],method:"artist.getsimilar"},b,function(b){for(var c=b.similarartists.artist.length,e=_.random(1,c-1),f=b.similarartists.artist[e].name;-1===d.indexOf(f);)-1!==d.indexOf(f)&&(e=e=_.random(1,c-1),f=b.similarartists.artist[e].name),a.addArtist(f),a.shuffleArtists()})},addArtist:function(a){d.push(a)},getArtists:function(){return d},shuffleArtists:function(){d=_.shuffle(d)},clearArtists:function(){d=[]},generate:function(a){for(var b,c=[],d=[];d.length<4;)b=_.random(1,this.getArtists().length-1),-1===d.indexOf(this.getArtists()[b])&&(d.push(this.getArtists()[b]),c.push({artist:this.getArtists()[b]}));for(var e=0;e<c.length;e++){var f=c[e].artist;this.getResponse({artist:f,method:"artist.gettopalbums"},e,function(d,e){if(d.topalbums.hasOwnProperty("album")){var f=d.topalbums.album.length;b=_.random(1,f-1),c[e].album=d.topalbums.album[b].name}e===c.length-1&&(trivia.setCurrentQuestion(c[e].artist),trivia.setCurrentAnswer(c[e].album),trivia.addTriviaMap(c)),a()})}},display:function(){trivia.shuffleTriviaMap(),$("li").removeClass("correct"),$("li").removeClass("incorrect"),$(".score").empty().append(a.getScore()),$(".question").empty().append(trivia.getCurrentQuestion());for(var b=0;b<trivia.getTriviaMap().length;b++)$(".choice"+(b+1)).empty().append(trivia.getTriviaMap()[b].album)},updateScore:function(){e+=5},getScore:function(){return e},resetScore:function(){e=0},loseLife:function(){$(".lives-icon"+f).fadeOut(),f--},getLives:function(){return f},resetLives:function(){$(".life").each(function(){$(this).fadeIn()}),f=3},init:function(b,c,d){a.addArtist(b),a.addArtist(c),a.addArtist(d),a.getSimilarArtists()}}}();$(".quiz").hide(),$(".results").hide(),$("form").on("submit",function(b){b.preventDefault(),a.init($(".artist1").val(),$(".artist2").val(),$(".artist3").val()),$(".user-input").fadeOut(),$(".quiz").fadeIn()}),$(".quiz li").on("click",function(){var b=trivia.verifyChoice($(this).text());b?($(this).addClass("correct"),a.updateScore()):($(this).addClass("incorrect"),a.loseLife(),0===a.getLives()&&($(".quiz").hide(),$(".results").fadeIn(),$(".results").append("<p>Final Score: "+a.getScore()+" </p>"))),a.generate(function(){a.display()})}),$(".restart").on("click",function(){a.resetScore(),a.resetLives(),a.clearArtists(),$(".quiz").fadeOut(),$(".results").fadeOut(),$(".user-input").fadeIn()}),test=a});